<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>M√°y quay s·ªë L√¥ T√¥ 1-90 Kh√¥ng L·∫∑p</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
        color: #fff;
        padding: 20px;
      }

      .container {
        background-color: rgba(0, 0, 0, 0.8);
        border-radius: 20px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
        padding: 40px;
        width: 100%;
        max-width: 1100px;
        text-align: center;
        border: 2px solid #fdbb2d;
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        color: #fdbb2d;
        text-shadow: 0 0 10px rgba(253, 187, 45, 0.5);
      }

      .subtitle {
        font-size: 1.2rem;
        margin-bottom: 30px;
        color: #ddd;
      }

      .number-display {
        font-size: 10rem;
        font-weight: bold;
        color: #fdbb2d;
        text-shadow: 0 0 20px rgba(253, 187, 45, 0.8);
        height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 30px 0;
        background-color: rgba(0, 0, 0, 0.6);
        border-radius: 20px;
        border: 3px solid #1a2a6c;
        position: relative;
        overflow: hidden;
      }

      .number-display::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(253, 187, 45, 0.1) 0%,
          rgba(0, 0, 0, 0) 70%
        );
        z-index: -1;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 18px 20px;
        font-size: 1.1rem;
        font-weight: bold;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        min-width: 160px;
      }

      .btn-start {
        background-color: #2ecc71;
        color: white;
      }

      .btn-start:hover:not(:disabled) {
        background-color: #27ae60;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(46, 204, 113, 0.4);
      }

      .btn-pause {
        background-color: #e74c3c;
        color: white;
      }

      .btn-pause:hover:not(:disabled) {
        background-color: #c0392b;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(231, 76, 60, 0.4);
      }

      .btn-reset {
        background-color: #3498db;
        color: white;
      }

      .btn-reset:hover:not(:disabled) {
        background-color: #2980b9;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(52, 152, 219, 0.4);
      }

      .btn-sound {
        background-color: #9b59b6;
        color: white;
      }

      .btn-sound:hover:not(:disabled) {
        background-color: #8e44ad;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(155, 89, 182, 0.4);
      }

      .btn-check {
        background-color: #f39c12;
        color: white;
      }

      .btn-check:hover:not(:disabled) {
        background-color: #d68910;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(243, 156, 18, 0.4);
      }

      .btn-time {
        background-color: #1abc9c;
        color: white;
      }

      .btn-time:hover:not(:disabled) {
        background-color: #16a085;
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(26, 188, 156, 0.4);
      }

      .btn:disabled {
        background-color: #7f8c8d;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        opacity: 0.7;
      }

      .status {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 25px;
        gap: 15px;
        flex-wrap: wrap;
      }

      .timer-container {
        background-color: rgba(26, 42, 108, 0.8);
        border-radius: 15px;
        padding: 15px 25px;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid #fdbb2d;
      }

      .timer-icon {
        font-size: 1.5rem;
        color: #fdbb2d;
      }

      .timer-text {
        font-size: 1.1rem;
        font-weight: bold;
      }

      .timer {
        font-size: 1.3rem;
        color: #fdbb2d;
        font-weight: bold;
      }

      .progress-container {
        background-color: rgba(0, 0, 0, 0.6);
        border-radius: 15px;
        padding: 10px 20px;
        margin-bottom: 20px;
        border: 1px solid #1a2a6c;
      }

      .progress-bar {
        width: 100%;
        height: 20px;
        background-color: #1a2a6c;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 10px;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #2ecc71, #fdbb2d);
        border-radius: 10px;
        transition: width 0.5s ease;
        width: 0%;
      }

      .progress-text {
        display: flex;
        justify-content: space-between;
        font-size: 1rem;
        margin-bottom: 5px;
      }

      .status-active {
        background-color: rgba(46, 204, 113, 0.2);
        padding: 12px 25px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid #2ecc71;
      }

      .status-paused {
        background-color: rgba(231, 76, 60, 0.2);
        padding: 12px 25px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid #e74c3c;
      }

      .status-completed {
        background-color: rgba(155, 89, 182, 0.2);
        padding: 12px 25px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid #9b59b6;
      }

      .audio-status {
        background-color: rgba(155, 89, 182, 0.2);
        padding: 12px 25px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        border: 2px solid #9b59b6;
      }

      .audio-icon {
        font-size: 1.5rem;
      }

      .history-container {
        background-color: rgba(0, 0, 0, 0.6);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
        border: 1px solid #1a2a6c;
        max-height: 300px;
        overflow-y: auto;
      }

      .history-title {
        font-size: 1.5rem;
        margin-bottom: 15px;
        color: #fdbb2d;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        position: sticky;
        top: 0;
        background-color: rgba(0, 0, 0, 0.8);
        padding: 10px;
        z-index: 10;
      }

      .history-numbers {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        gap: 8px;
        justify-content: center;
        padding: 10px;
      }

      .history-number {
        background-color: #1a2a6c;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
        border: 2px solid #fdbb2d;
        transition: all 0.3s ease;
        margin: 0 auto;
      }

      .history-number.recent {
        background-color: #fdbb2d;
        color: #1a2a6c;
        transform: scale(1.1);
        box-shadow: 0 0 15px rgba(253, 187, 45, 0.7);
      }

      .history-number.found {
        background-color: #e74c3c;
        color: white;
        border-color: #e74c3c;
        animation: pulse 0.5s ease-in-out 3;
      }

      .history-number.used {
        background-color: #2ecc71;
        color: white;
        border-color: #2ecc71;
      }

      .instructions {
        margin-top: 25px;
        font-size: 1rem;
        color: #ddd;
        line-height: 1.5;
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        text-align: left;
      }

      .instructions ul {
        margin-left: 20px;
        margin-top: 10px;
      }

      .instructions li {
        margin-bottom: 5px;
      }

      .warning {
        background-color: rgba(231, 76, 60, 0.2);
        border: 1px solid #e74c3c;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
        text-align: center;
      }

      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background-color: rgba(0, 0, 0, 0.9);
        padding: 30px;
        border-radius: 20px;
        width: 90%;
        max-width: 500px;
        border: 2px solid #fdbb2d;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      .modal-title {
        font-size: 1.8rem;
        margin-bottom: 20px;
        color: #fdbb2d;
        text-align: center;
      }

      .modal-input {
        width: 100%;
        padding: 15px;
        font-size: 1.5rem;
        text-align: center;
        border-radius: 10px;
        border: 2px solid #1a2a6c;
        background-color: rgba(255, 255, 255, 0.1);
        color: white;
        margin-bottom: 20px;
      }

      .modal-input:focus {
        outline: none;
        border-color: #fdbb2d;
      }

      .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      .modal-btn {
        padding: 12px 25px;
        font-size: 1.1rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 120px;
      }

      .modal-btn.confirm {
        background-color: #2ecc71;
        color: white;
      }

      .modal-btn.confirm:hover {
        background-color: #27ae60;
      }

      .modal-btn.cancel {
        background-color: #e74c3c;
        color: white;
      }

      .modal-btn.cancel:hover {
        background-color: #c0392b;
      }

      .result-message {
        font-size: 1.3rem;
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }

      .result-success {
        background-color: rgba(46, 204, 113, 0.2);
        border: 2px solid #2ecc71;
        color: #2ecc71;
      }

      .result-failure {
        background-color: rgba(231, 76, 60, 0.2);
        border: 2px solid #e74c3c;
        color: #e74c3c;
      }

      .time-info {
        font-size: 1rem;
        color: #fdbb2d;
        margin-top: 10px;
        text-align: center;
      }

      @media (max-width: 1024px) {
        .history-numbers {
          grid-template-columns: repeat(8, 1fr);
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 25px;
        }

        h1 {
          font-size: 2.2rem;
        }

        .number-display {
          font-size: 7rem;
          height: 160px;
        }

        .btn {
          padding: 15px 15px;
          min-width: 140px;
          font-size: 1rem;
        }

        .controls {
          gap: 10px;
        }

        .status {
          flex-direction: column;
        }

        .history-numbers {
          grid-template-columns: repeat(6, 1fr);
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.8rem;
        }

        .number-display {
          font-size: 5rem;
          height: 140px;
        }

        .btn {
          padding: 12px 10px;
          min-width: 120px;
          font-size: 0.9rem;
        }

        .history-number {
          width: 40px;
          height: 40px;
          font-size: 1rem;
        }

        .history-numbers {
          grid-template-columns: repeat(5, 1fr);
        }
      }

      /* Animation cho s·ªë ƒëang quay */
      @keyframes spin {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
        100% {
          transform: scale(1);
        }
      }

      .spinning {
        animation: spin 0.2s infinite;
      }

      /* Animation cho s·ªë m·ªõi xu·∫•t hi·ªán */
      @keyframes appear {
        0% {
          transform: scale(0.5);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .appear {
        animation: appear 0.5s ease-out;
      }

      /* Animation cho s·ªë t√¨m th·∫•y */
      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1><i class="fas fa-dice"></i> M√°y Quay S·ªë L√¥ T√¥ 1-90</h1>
      <p class="subtitle">
        T·ª± ƒë·ªông quay s·ªë kh√¥ng l·∫∑p - Th·ªùi gian:
        <span id="currentInterval">3</span> gi√¢y
      </p>

      <div class="progress-container">
        <div class="progress-text">
          <span>Ti·∫øn ƒë·ªô: <span id="progressCount">0</span>/90 s·ªë</span>
          <span><span id="remainingCount">90</span> s·ªë c√≤n l·∫°i</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
      </div>

      <div class="status">
        <div class="timer-container">
          <i class="fas fa-clock timer-icon"></i>
          <span class="timer-text">S·ªë ti·∫øp theo sau:</span>
          <span class="timer" id="timer">3</span>
          <span class="timer-text">gi√¢y</span>
        </div>

        <div class="status-active" id="statusActive" style="display: none">
          <i class="fas fa-play-circle status-icon"></i>
          <span>ƒêang ch·∫°y t·ª± ƒë·ªông</span>
        </div>

        <div class="status-paused" id="statusPaused">
          <i class="fas fa-pause-circle status-icon"></i>
          <span>ƒê√£ t·∫°m d·ª´ng</span>
        </div>

        <div
          class="status-completed"
          id="statusCompleted"
          style="display: none"
        >
          <i class="fas fa-flag-checkered status-icon"></i>
          <span>ƒê√£ quay ƒë·ªß 90 s·ªë!</span>
        </div>

        <div class="audio-status" id="audioStatus">
          <i class="fas fa-volume-up audio-icon"></i>
          <span>Audio: B·∫≠t</span>
        </div>
      </div>

      <div class="number-display" id="numberDisplay">00</div>

      <div class="controls">
        <button class="btn btn-start" id="startBtn">
          <i class="fas fa-play"></i> B·∫Øt ƒë·∫ßu
        </button>
        <button class="btn btn-pause" id="pauseBtn" disabled>
          <i class="fas fa-pause"></i> T·∫°m d·ª´ng
        </button>
        <button class="btn btn-reset" id="resetBtn">
          <i class="fas fa-redo"></i> L√†m m·ªõi
        </button>
        <button class="btn btn-sound" id="soundBtn">
          <i class="fas fa-volume-up"></i> T·∫Øt ti·∫øng
        </button>
        <button class="btn btn-check" id="checkBtn">
          <i class="fas fa-search"></i> D√≤ s·ªë
        </button>
        <button class="btn btn-time" id="timeBtn">
          <i class="fas fa-cog"></i> Th·ªùi gian
        </button>
      </div>

      <div class="history-container">
        <h3 class="history-title">
          <i class="fas fa-history"></i> L·ªãch s·ª≠ quay s·ªë (<span
            id="historyCount"
            >0</span
          >/90)
        </h3>
        <div class="history-numbers" id="historyNumbers">
          <!-- C√°c s·ªë ƒë√£ quay s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
        </div>
      </div>

      <div class="result-message" id="resultMessage"></div>

      <div class="instructions">
        <p><strong>H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng:</strong></p>
        <ul>
          <li>
            <strong>B·∫Øt ƒë·∫ßu</strong>: H·ªá th·ªëng t·ª± ƒë·ªông t·∫°o s·ªë ng·∫´u nhi√™n kh√¥ng
            l·∫∑p m·ªói <span id="intervalDisplay">3</span> gi√¢y.
          </li>
          <li><strong>T·∫°m d·ª´ng</strong>: D·ª´ng qu√° tr√¨nh t·ª± ƒë·ªông.</li>
          <li>
            <strong>L√†m m·ªõi</strong>: Reset v·ªÅ 00 v√† x√≥a l·ªãch s·ª≠, b·∫Øt ƒë·∫ßu l·∫°i t·ª´
            ƒë·∫ßu.
          </li>
          <li>
            <strong>T·∫Øt ti·∫øng/B·∫≠t ti·∫øng</strong>: ƒêi·ªÅu khi·ªÉn √¢m thanh ƒë·ªçc s·ªë.
          </li>
          <li><strong>D√≤ s·ªë</strong>: Ki·ªÉm tra s·ªë c√≥ trong l·ªãch s·ª≠ kh√¥ng.</li>
          <li>
            <strong>Th·ªùi gian</strong>: Thay ƒë·ªïi th·ªùi gian t·ª± ƒë·ªông gi·ªØa c√°c s·ªë
            (1-10 gi√¢y).
          </li>
          <li>
            <strong>ƒê·∫∑c ƒëi·ªÉm</strong>: M·ªói s·ªë t·ª´ 1-90 ch·ªâ xu·∫•t hi·ªán 1 l·∫ßn duy
            nh·∫•t. Khi ƒë·ªß 90 s·ªë s·∫Ω t·ª± ƒë·ªông d·ª´ng.
          </li>
        </ul>

        <div class="warning" id="audioWarning" style="display: none">
          <p>
            <i class="fas fa-exclamation-triangle"></i>
            <strong>L∆∞u √Ω:</strong> Tr√¨nh duy·ªát c·ªßa b·∫°n c√≥ th·ªÉ c·∫ßn cho ph√©p √¢m
            thanh ƒë·ªÉ nghe ƒë·ªçc s·ªë. N·∫øu kh√¥ng nghe th·∫•y ti·∫øng, h√£y ki·ªÉm tra c√†i
            ƒë·∫∑t √¢m thanh tr√¨nh duy·ªát.
          </p>
        </div>
      </div>
    </div>

    <!-- Modal d√≤ s·ªë -->
    <div class="modal" id="checkModal">
      <div class="modal-content">
        <h2 class="modal-title"><i class="fas fa-search"></i> D√≤ s·ªë</h2>
        <p style="text-align: center; margin-bottom: 20px">
          Nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 90 ƒë·ªÉ ki·ªÉm tra:
        </p>
        <input
          type="number"
          class="modal-input"
          id="checkNumberInput"
          min="1"
          max="90"
          placeholder="Nh·∫≠p s·ªë..."
        />
        <div class="modal-buttons">
          <button class="modal-btn confirm" id="checkConfirmBtn">
            Ki·ªÉm tra
          </button>
          <button class="modal-btn cancel" id="checkCancelBtn">H·ªßy</button>
        </div>
      </div>
    </div>

    <!-- Modal ch·ªânh th·ªùi gian -->
    <div class="modal" id="timeModal">
      <div class="modal-content">
        <h2 class="modal-title"><i class="fas fa-cog"></i> Ch·ªânh th·ªùi gian</h2>
        <p style="text-align: center; margin-bottom: 20px">
          Nh·∫≠p th·ªùi gian gi·ªØa c√°c s·ªë (gi√¢y):
        </p>
        <input
          type="number"
          class="modal-input"
          id="timeIntervalInput"
          min="1"
          max="10"
          value="3"
          placeholder="Nh·∫≠p s·ªë gi√¢y..."
        />
        <div class="time-info">Gi√° tr·ªã h·ª£p l·ªá: t·ª´ 1 ƒë·∫øn 10 gi√¢y</div>
        <div class="modal-buttons">
          <button class="modal-btn confirm" id="timeConfirmBtn">
            C·∫≠p nh·∫≠t
          </button>
          <button class="modal-btn cancel" id="timeCancelBtn">H·ªßy</button>
        </div>
      </div>
    </div>

    <script>
      // C√°c bi·∫øn to√†n c·ª•c
      let autoInterval = null;
      let timerInterval = null;
      let isAutoRunning = false;
      let currentNumber = 0;
      let allNumbers = []; // T·∫•t c·∫£ s·ªë t·ª´ 1-90
      let availableNumbers = []; // S·ªë c√≤n l·∫°i ch∆∞a quay
      let history = []; // L·ªãch s·ª≠ c√°c s·ªë ƒë√£ quay
      let timeLeft = 3; // Th·ªùi gian ƒë·∫øm ng∆∞·ª£c
      let intervalTime = 3; // Th·ªùi gian gi·ªØa c√°c s·ªë (gi√¢y) - m·∫∑c ƒë·ªãnh 3
      let soundEnabled = true; // Tr·∫°ng th√°i √¢m thanh
      const totalNumbers = 90; // T·ªïng s·ªë l∆∞·ª£ng s·ªë
      let isCompleted = false; // ƒê√£ quay ƒë·ªß 90 s·ªë ch∆∞a

      // Ki·ªÉm tra tr√¨nh duy·ªát h·ªó tr·ª£ Web Speech API
      const speechSupported = "speechSynthesis" in window;

      // C√°c ph·∫ßn t·ª≠ DOM
      const numberDisplay = document.getElementById("numberDisplay");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");
      const resetBtn = document.getElementById("resetBtn");
      const soundBtn = document.getElementById("soundBtn");
      const checkBtn = document.getElementById("checkBtn");
      const timeBtn = document.getElementById("timeBtn");
      const historyNumbers = document.getElementById("historyNumbers");
      const historyCount = document.getElementById("historyCount");
      const timerDisplay = document.getElementById("timer");
      const currentIntervalDisplay = document.getElementById("currentInterval");
      const intervalDisplay = document.getElementById("intervalDisplay");
      const statusActive = document.getElementById("statusActive");
      const statusPaused = document.getElementById("statusPaused");
      const statusCompleted = document.getElementById("statusCompleted");
      const audioStatus = document.getElementById("audioStatus");
      const audioWarning = document.getElementById("audioWarning");
      const resultMessage = document.getElementById("resultMessage");
      const progressCount = document.getElementById("progressCount");
      const remainingCount = document.getElementById("remainingCount");
      const progressFill = document.getElementById("progressFill");

      // Modal elements
      const checkModal = document.getElementById("checkModal");
      const timeModal = document.getElementById("timeModal");
      const checkNumberInput = document.getElementById("checkNumberInput");
      const timeIntervalInput = document.getElementById("timeIntervalInput");
      const checkConfirmBtn = document.getElementById("checkConfirmBtn");
      const checkCancelBtn = document.getElementById("checkCancelBtn");
      const timeConfirmBtn = document.getElementById("timeConfirmBtn");
      const timeCancelBtn = document.getElementById("timeCancelBtn");

      // Kh·ªüi t·∫°o danh s√°ch s·ªë t·ª´ 1 ƒë·∫øn 90
      function initializeNumbers() {
        allNumbers = Array.from({ length: totalNumbers }, (_, i) => i + 1);
        resetAvailableNumbers();
      }

      // Reset danh s√°ch s·ªë ch∆∞a quay
      function resetAvailableNumbers() {
        availableNumbers = [...allNumbers]; // Sao ch√©p t·∫•t c·∫£ s·ªë
        history = [];
        isCompleted = false;
        updateHistoryDisplay();
        updateProgress();
        updateStatusDisplay();
      }

      // H√†m t·∫°o s·ªë ng·∫´u nhi√™n t·ª´ danh s√°ch s·ªë ch∆∞a quay
      function generateRandomNumber() {
        if (availableNumbers.length === 0) {
          return null; // ƒê√£ h·∫øt s·ªë
        }

        const randomIndex = Math.floor(Math.random() * availableNumbers.length);
        const number = availableNumbers[randomIndex];

        // X√≥a s·ªë ƒë√£ quay kh·ªèi danh s√°ch s·ªë ch∆∞a quay
        availableNumbers.splice(randomIndex, 1);

        return number;
      }

      // H√†m ƒë·ªçc s·ªë b·∫±ng Web Speech API
      function speakNumber(number) {
        if (!soundEnabled || !speechSupported) return;

        // D·ª´ng b·∫•t k·ª≥ l·ªùi n√≥i n√†o ƒëang di·ªÖn ra
        window.speechSynthesis.cancel();

        // T·∫°o vƒÉn b·∫£n ƒë·ªÉ ƒë·ªçc
        const text = `S·ªë ${number}`;
        const utterance = new SpeechSynthesisUtterance(text);

        // C√†i ƒë·∫∑t ti·∫øng Vi·ªát n·∫øu c√≥
        utterance.lang = "vi-VN";
        utterance.rate = 0.9; // T·ªëc ƒë·ªô n√≥i (0.1 ƒë·∫øn 10)
        utterance.pitch = 1; // Cao ƒë·ªô (0 ƒë·∫øn 2)
        utterance.volume = 1; // √Çm l∆∞·ª£ng (0 ƒë·∫øn 1)

        // T√¨m gi·ªçng ti·∫øng Vi·ªát n·∫øu c√≥
        const voices = window.speechSynthesis.getVoices();
        const vietnameseVoice = voices.find(
          (voice) => voice.lang === "vi-VN" || voice.lang === "vi",
        );

        if (vietnameseVoice) {
          utterance.voice = vietnameseVoice;
        }

        // B·∫Øt ƒë·∫ßu n√≥i
        window.speechSynthesis.speak(utterance);

        // Hi·ªÉn th·ªã c·∫£nh b√°o n·∫øu kh√¥ng c√≥ gi·ªçng ti·∫øng Vi·ªát
        if (!vietnameseVoice) {
          audioWarning.style.display = "block";
          audioWarning.innerHTML = `<p><i class="fas fa-exclamation-triangle"></i> <strong>L∆∞u √Ω:</strong> Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng c√≥ gi·ªçng ƒë·ªçc ti·∫øng Vi·ªát. C√≥ th·ªÉ s·ª≠ d·ª•ng gi·ªçng m·∫∑c ƒë·ªãnh (ti·∫øng Anh) ho·∫∑c c√†i ƒë·∫∑t gi·ªçng ti·∫øng Vi·ªát.</p>`;
        }
      }

      // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã s·ªë v·ªõi hi·ªáu ·ª©ng
      function updateNumberDisplay(number) {
        numberDisplay.textContent = number.toString().padStart(2, "0");
        currentNumber = number;

        // Th√™m hi·ªáu ·ª©ng xu·∫•t hi·ªán
        numberDisplay.classList.remove("appear");
        void numberDisplay.offsetWidth; // K√≠ch ho·∫°t l·∫°i animation
        numberDisplay.classList.add("appear");

        // ƒê·ªçc s·ªë n·∫øu √¢m thanh ƒë∆∞·ª£c b·∫≠t
        if (soundEnabled) {
          speakNumber(number);
        }
      }

      // H√†m t·∫°o s·ªë m·ªõi v√† th√™m v√†o l·ªãch s·ª≠
      function generateNewNumber() {
        // Ki·ªÉm tra xem ƒë√£ quay ƒë·ªß 90 s·ªë ch∆∞a
        if (availableNumbers.length === 0) {
          completeAllNumbers();
          return;
        }

        const newNumber = generateRandomNumber();

        if (newNumber === null) {
          completeAllNumbers();
          return;
        }

        updateNumberDisplay(newNumber);
        addToHistory(newNumber);
        updateProgress();

        // Reset b·ªô ƒë·∫øm th·ªùi gian
        timeLeft = intervalTime;
        updateTimerDisplay();
      }

      // H√†m x·ª≠ l√Ω khi ƒë√£ quay ƒë·ªß 90 s·ªë
      function completeAllNumbers() {
        isCompleted = true;
        pauseAutoMode();
        updateStatusDisplay();

        showResultMessage("üéâ Ch√∫c m·ª´ng! ƒê√£ quay ƒë·ªß 90 s·ªë t·ª´ 1 ƒë·∫øn 90!", true);

        // ƒê·ªçc th√¥ng b√°o k·∫øt th√∫c
        if (soundEnabled && speechSupported) {
          setTimeout(() => {
            const utterance = new SpeechSynthesisUtterance(
              "ƒê√£ quay ƒë·ªß 90 s·ªë. Ch∆∞∆°ng tr√¨nh k·∫øt th√∫c!",
            );
            utterance.lang = "vi-VN";
            window.speechSynthesis.speak(utterance);
          }, 1000);
        }
      }

      // H√†m b·∫Øt ƒë·∫ßu ch·∫ø ƒë·ªô t·ª± ƒë·ªông
      function startAutoMode() {
        if (isAutoRunning || isCompleted) return;

        isAutoRunning = true;
        startBtn.disabled = true;
        pauseBtn.disabled = false;
        updateStatusDisplay();

        // T·∫°o s·ªë ƒë·∫ßu ti√™n ngay l·∫≠p t·ª©c
        generateNewNumber();

        // B·∫Øt ƒë·∫ßu interval t·∫°o s·ªë m·ªói kho·∫£ng th·ªùi gian ƒë√£ ƒë·∫∑t
        autoInterval = setInterval(generateNewNumber, intervalTime * 1000);

        // B·∫Øt ƒë·∫ßu b·ªô ƒë·∫øm th·ªùi gian
        startTimer();
      }

      // H√†m t·∫°m d·ª´ng ch·∫ø ƒë·ªô t·ª± ƒë·ªông
      function pauseAutoMode() {
        if (!isAutoRunning) return;

        isAutoRunning = false;
        clearInterval(autoInterval);
        clearInterval(timerInterval);
        startBtn.disabled = false;
        pauseBtn.disabled = true;
        updateStatusDisplay();

        // D·ª´ng ƒë·ªçc n·∫øu ƒëang n√≥i
        if (speechSupported) {
          window.speechSynthesis.cancel();
        }
      }

      // H√†m l√†m m·ªõi/reset
      function resetAll() {
        // D·ª´ng ch·∫ø ƒë·ªô t·ª± ƒë·ªông n·∫øu ƒëang ch·∫°y
        pauseAutoMode();

        // D·ª´ng ƒë·ªçc n·∫øu ƒëang n√≥i
        if (speechSupported) {
          window.speechSynthesis.cancel();
        }

        // Reset v·ªÅ 00
        updateNumberDisplay(0);

        // Reset danh s√°ch s·ªë
        resetAvailableNumbers();

        // Reset b·ªô ƒë·∫øm th·ªùi gian
        timeLeft = intervalTime;
        updateTimerDisplay();

        // ·∫®n th√¥ng b√°o k·∫øt qu·∫£
        hideResultMessage();
      }

      // H√†m b·∫≠t/t·∫Øt √¢m thanh
      function toggleSound() {
        soundEnabled = !soundEnabled;

        // C·∫≠p nh·∫≠t n√∫t v√† tr·∫°ng th√°i
        if (soundEnabled) {
          soundBtn.innerHTML = '<i class="fas fa-volume-up"></i> T·∫Øt ti·∫øng';
          audioStatus.innerHTML =
            '<i class="fas fa-volume-up audio-icon"></i> <span>Audio: B·∫≠t</span>';
          audioStatus.style.backgroundColor = "rgba(155, 89, 182, 0.2)";
          audioStatus.style.borderColor = "#9b59b6";

          // N·∫øu c√≥ s·ªë hi·ªán t·∫°i, ƒë·ªçc l·∫°i
          if (currentNumber > 0) {
            speakNumber(currentNumber);
          }
        } else {
          soundBtn.innerHTML = '<i class="fas fa-volume-mute"></i> B·∫≠t ti·∫øng';
          audioStatus.innerHTML =
            '<i class="fas fa-volume-mute audio-icon"></i> <span>Audio: T·∫Øt</span>';
          audioStatus.style.backgroundColor = "rgba(149, 165, 166, 0.2)";
          audioStatus.style.borderColor = "#95a5a6";

          // D·ª´ng ƒë·ªçc n·∫øu ƒëang n√≥i
          if (speechSupported) {
            window.speechSynthesis.cancel();
          }
        }

        // L∆∞u tr·∫°ng th√°i v√†o localStorage
        localStorage.setItem("lotoSoundEnabled", soundEnabled);
      }

      // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã tr·∫°ng th√°i
      function updateStatusDisplay() {
        if (isCompleted) {
          statusActive.style.display = "none";
          statusPaused.style.display = "none";
          statusCompleted.style.display = "flex";
        } else if (isAutoRunning) {
          statusActive.style.display = "flex";
          statusPaused.style.display = "none";
          statusCompleted.style.display = "none";
        } else {
          statusActive.style.display = "none";
          statusPaused.style.display = "flex";
          statusCompleted.style.display = "none";
        }
      }

      // H√†m b·∫Øt ƒë·∫ßu b·ªô ƒë·∫øm th·ªùi gian
      function startTimer() {
        clearInterval(timerInterval);
        updateTimerDisplay();

        timerInterval = setInterval(() => {
          timeLeft--;
          updateTimerDisplay();

          if (timeLeft <= 0) {
            timeLeft = intervalTime;
          }
        }, 1000);
      }

      // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã b·ªô ƒë·∫øm th·ªùi gian
      function updateTimerDisplay() {
        timerDisplay.textContent = timeLeft;

        // Thay ƒë·ªïi m√†u khi g·∫ßn ƒë·∫øn 0
        if (timeLeft <= 3) {
          timerDisplay.style.color = "#e74c3c";
        } else {
          timerDisplay.style.color = "#fdbb2d";
        }
      }

      // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã th·ªùi gian interval
      function updateIntervalDisplay() {
        currentIntervalDisplay.textContent = intervalTime;
        intervalDisplay.textContent = intervalTime;
      }

      // H√†m c·∫≠p nh·∫≠t ti·∫øn ƒë·ªô
      function updateProgress() {
        const usedCount = history.length;
        const remaining = totalNumbers - usedCount;
        const percentage = (usedCount / totalNumbers) * 100;

        progressCount.textContent = usedCount;
        remainingCount.textContent = remaining;
        progressFill.style.width = `${percentage}%`;
      }

      // H√†m th√™m s·ªë v√†o l·ªãch s·ª≠
      function addToHistory(number) {
        // Th√™m s·ªë v√†o ƒë·∫ßu m·∫£ng
        history.unshift(number);

        updateHistoryDisplay();
      }

      // H√†m c·∫≠p nh·∫≠t hi·ªÉn th·ªã l·ªãch s·ª≠
      function updateHistoryDisplay() {
        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng
        historyCount.textContent = history.length;

        // X√≥a n·ªôi dung c≈©
        historyNumbers.innerHTML = "";

        // T·∫°o c√°c s·ªë t·ª´ 1 ƒë·∫øn 90
        for (let i = 1; i <= totalNumbers; i++) {
          const numberElement = document.createElement("div");
          numberElement.className = "history-number";
          numberElement.id = `history-${i}`;
          numberElement.textContent = i.toString().padStart(2, "0");

          // Ki·ªÉm tra s·ªë ƒë√£ ƒë∆∞·ª£c quay ch∆∞a
          if (history.includes(i)) {
            numberElement.classList.add("used");

            // N·∫øu l√† s·ªë g·∫ßn nh·∫•t
            if (i === currentNumber) {
              numberElement.classList.add("recent");
            }
          }

          historyNumbers.appendChild(numberElement);
        }
      }

      // H√†m t√¨m s·ªë trong l·ªãch s·ª≠
      function checkNumberInHistory(number) {
        return history.includes(number);
      }

      // H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ d√≤ s·ªë
      function showResultMessage(message, isSuccess) {
        resultMessage.textContent = message;
        resultMessage.className = `result-message ${isSuccess ? "result-success" : "result-failure"}`;
        resultMessage.style.display = "block";

        // T·ª± ƒë·ªông ·∫©n sau 5 gi√¢y
        setTimeout(hideResultMessage, 5000);
      }

      // H√†m ·∫©n th√¥ng b√°o k·∫øt qu·∫£
      function hideResultMessage() {
        resultMessage.style.display = "none";
      }

      // H√†m l√†m n·ªïi b·∫≠t s·ªë t√¨m th·∫•y trong l·ªãch s·ª≠
      function highlightFoundNumber(number) {
        // X√≥a highlight c≈©
        document.querySelectorAll(".history-number.found").forEach((el) => {
          el.classList.remove("found");
        });

        // Highlight s·ªë m·ªõi
        const element = document.getElementById(`history-${number}`);
        if (element) {
          element.classList.add("found");

          // Cu·ªôn ƒë·∫øn v·ªã tr√≠ c·ªßa s·ªë
          element.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      }

      // H√†m m·ªü modal d√≤ s·ªë
      function openCheckModal() {
        checkNumberInput.value = "";
        checkModal.style.display = "flex";
        checkNumberInput.focus();
      }

      // H√†m ƒë√≥ng modal d√≤ s·ªë
      function closeCheckModal() {
        checkModal.style.display = "none";
      }

      // H√†m x·ª≠ l√Ω d√≤ s·ªë
      function handleCheckNumber() {
        const inputValue = checkNumberInput.value.trim();
        const number = parseInt(inputValue);

        if (isNaN(number) || number < 1 || number > 90) {
          alert("Vui l√≤ng nh·∫≠p s·ªë h·ª£p l·ªá t·ª´ 1 ƒë·∫øn 90!");
          checkNumberInput.focus();
          return;
        }

        const found = checkNumberInHistory(number);

        if (found) {
          showResultMessage(
            `S·ªë ${number} ƒë√£ xu·∫•t hi·ªán trong l·ªãch s·ª≠ quay s·ªë!`,
            true,
          );

          // T·∫°m d·ª´ng n·∫øu ƒëang ch·∫°y t·ª± ƒë·ªông
          if (isAutoRunning) {
            pauseAutoMode();
          }

          // L√†m n·ªïi b·∫≠t s·ªë t√¨m th·∫•y
          highlightFoundNumber(number);
        } else {
          showResultMessage(
            `S·ªë ${number} ch∆∞a xu·∫•t hi·ªán trong l·ªãch s·ª≠ quay s·ªë.`,
            false,
          );
        }

        closeCheckModal();
      }

      // H√†m m·ªü modal ch·ªânh th·ªùi gian
      function openTimeModal() {
        timeIntervalInput.value = intervalTime;
        timeModal.style.display = "flex";
        timeIntervalInput.focus();
      }

      // H√†m ƒë√≥ng modal ch·ªânh th·ªùi gian
      function closeTimeModal() {
        timeModal.style.display = "none";
      }

      // H√†m x·ª≠ l√Ω ch·ªânh th·ªùi gian
      function handleTimeChange() {
        const inputValue = timeIntervalInput.value.trim();
        const newInterval = parseInt(inputValue);

        if (isNaN(newInterval) || newInterval < 1 || newInterval > 10) {
          alert("Vui l√≤ng nh·∫≠p th·ªùi gian h·ª£p l·ªá t·ª´ 1 ƒë·∫øn 10 gi√¢y!");
          timeIntervalInput.focus();
          return;
        }

        intervalTime = newInterval;
        timeLeft = intervalTime;

        // C·∫≠p nh·∫≠t hi·ªÉn th·ªã
        updateIntervalDisplay();
        updateTimerDisplay();

        // N·∫øu ƒëang ch·∫°y t·ª± ƒë·ªông, c·∫≠p nh·∫≠t interval
        if (isAutoRunning) {
          clearInterval(autoInterval);
          autoInterval = setInterval(generateNewNumber, intervalTime * 1000);

          // Reset b·ªô ƒë·∫øm
          startTimer();
        }

        showResultMessage(
          `ƒê√£ c·∫≠p nh·∫≠t th·ªùi gian t·ª± ƒë·ªông th√†nh ${intervalTime} gi√¢y.`,
          true,
        );

        // L∆∞u v√†o localStorage
        localStorage.setItem("lotoIntervalTime", intervalTime);

        closeTimeModal();
      }

      // H√†m ki·ªÉm tra v√† kh·ªüi t·∫°o Web Speech API
      function initSpeech() {
        if (!speechSupported) {
          // N·∫øu kh√¥ng h·ªó tr·ª£ Web Speech API
          audioWarning.style.display = "block";
          audioWarning.innerHTML = `<p><i class="fas fa-exclamation-triangle"></i> <strong>Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n th√†nh ti·∫øng.</strong> T√≠nh nƒÉng audio s·∫Ω kh√¥ng ho·∫°t ƒë·ªông. Vui l√≤ng s·ª≠ d·ª•ng Chrome, Edge ho·∫∑c Safari phi√™n b·∫£n m·ªõi.</p>`;
          soundBtn.disabled = true;
          soundBtn.style.opacity = "0.5";
          soundEnabled = false;
          audioStatus.innerHTML =
            '<i class="fas fa-volume-mute audio-icon"></i> <span>Audio: Kh√¥ng h·ªó tr·ª£</span>';
          audioStatus.style.backgroundColor = "rgba(149, 165, 166, 0.2)";
          audioStatus.style.borderColor = "#95a5a6";
          return;
        }

        // ƒê·ª£i danh s√°ch gi·ªçng n√≥i ƒë∆∞·ª£c t·∫£i
        window.speechSynthesis.onvoiceschanged = function () {
          console.log("ƒê√£ t·∫£i danh s√°ch gi·ªçng n√≥i. S·∫µn s√†ng ƒë·ªçc s·ªë.");
        };
      }

      // H√†m kh·ªüi t·∫°o
      function init() {
        // Kh·ªüi t·∫°o danh s√°ch s·ªë
        initializeNumbers();

        // Kh·ªüi t·∫°o Web Speech API
        initSpeech();

        // ƒê·ªçc c√†i ƒë·∫∑t t·ª´ localStorage
        const savedSoundState = localStorage.getItem("lotoSoundEnabled");
        if (savedSoundState !== null) {
          soundEnabled = savedSoundState === "true";
          if (!soundEnabled) {
            toggleSound(); // C·∫≠p nh·∫≠t giao di·ªán
          }
        }

        const savedIntervalTime = localStorage.getItem("lotoIntervalTime");
        if (savedIntervalTime !== null) {
          intervalTime = parseInt(savedIntervalTime);
          timeLeft = intervalTime;
          updateIntervalDisplay();
          updateTimerDisplay();
        }

        // ƒê·∫∑t s·ª± ki·ªán cho c√°c n√∫t ch√≠nh
        startBtn.addEventListener("click", startAutoMode);
        pauseBtn.addEventListener("click", pauseAutoMode);
        resetBtn.addEventListener("click", resetAll);
        soundBtn.addEventListener("click", toggleSound);
        checkBtn.addEventListener("click", openCheckModal);
        timeBtn.addEventListener("click", openTimeModal);

        // ƒê·∫∑t s·ª± ki·ªán cho modal d√≤ s·ªë
        checkConfirmBtn.addEventListener("click", handleCheckNumber);
        checkCancelBtn.addEventListener("click", closeCheckModal);
        checkNumberInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            handleCheckNumber();
          }
        });

        // ƒê·∫∑t s·ª± ki·ªán cho modal th·ªùi gian
        timeConfirmBtn.addEventListener("click", handleTimeChange);
        timeCancelBtn.addEventListener("click", closeTimeModal);
        timeIntervalInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            handleTimeChange();
          }
        });

        // ƒê√≥ng modal khi click ra ngo√†i
        window.addEventListener("click", function (e) {
          if (e.target === checkModal) {
            closeCheckModal();
          }
          if (e.target === timeModal) {
            closeTimeModal();
          }
        });

        // Kh·ªüi t·∫°o hi·ªÉn th·ªã
        updateNumberDisplay(0);
        updateHistoryDisplay();
        updateTimerDisplay();
        updateProgress();

        // Th√™m hi·ªáu ·ª©ng cho s·ªë khi click
        numberDisplay.addEventListener("click", () => {
          if (!isAutoRunning && !isCompleted) {
            // N·∫øu ƒëang kh√¥ng ch·∫°y t·ª± ƒë·ªông v√† ch∆∞a ho√†n th√†nh, click v√†o s·ªë s·∫Ω quay 1 s·ªë ng·∫´u nhi√™n
            generateNewNumber();
          }
        });

        // Th√™m kh·∫£ nƒÉng d√πng ph√≠m t·∫Øt
        document.addEventListener("keydown", (e) => {
          // Kh√¥ng d√πng ph√≠m t·∫Øt n·∫øu ƒëang focus v√†o input
          if (e.target.tagName === "INPUT") return;

          switch (e.code) {
            case "Space":
            case "Enter":
              if (isAutoRunning) {
                pauseAutoMode();
              } else if (!isCompleted) {
                startAutoMode();
              }
              e.preventDefault();
              break;
            case "Escape":
              resetAll();
              e.preventDefault();
              break;
            case "KeyN":
              if (!isAutoRunning && !isCompleted) {
                generateNewNumber();
              }
              e.preventDefault();
              break;
            case "KeyM":
              toggleSound();
              e.preventDefault();
              break;
            case "KeyC":
              openCheckModal();
              e.preventDefault();
              break;
            case "KeyT":
              openTimeModal();
              e.preventDefault();
              break;
          }
        });
      }

      // Kh·ªüi ch·∫°y khi trang ƒë√£ t·∫£i xong
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
